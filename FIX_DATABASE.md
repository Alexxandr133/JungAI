# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–¢–∞–±–ª–∏—Ü–∞ `SupportRequest` –∏ –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ Prisma –Ω–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é.

## –†–µ—à–µ–Ω–∏–µ: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
ssh root@212.193.30.213
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É/backend
npm run prisma:migrate:deploy
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –Ω–µ–ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `SupportRequest`.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

–ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ `prisma migrate deploy` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é:

```bash
ssh root@212.193.30.213
cd /var/www/jingai/backend
sqlite3 prisma/prod.db < prisma/migrations/20251209000002_add_support_request/migration.sql
```

–ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ sqlite3 –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ:
```bash
cd /var/www/jingai/backend
sqlite3 prisma/prod.db
```

–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã SupportRequest
CREATE TABLE "SupportRequest" (
    "id" TEXT NOT NULL PRIMARY KEY,
    "psychologistId" TEXT NOT NULL,
    "title" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "allowWorkAreaAccess" BOOLEAN NOT NULL DEFAULT 0,
    "clientId" TEXT,
    "status" TEXT NOT NULL DEFAULT 'open',
    "adminResponse" TEXT,
    "respondedBy" TEXT,
    "respondedAt" DATETIME,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    CONSTRAINT "SupportRequest_clientId_fkey" FOREIGN KEY ("clientId") REFERENCES "Client" ("id") ON DELETE SET NULL ON UPDATE CASCADE
);

-- –í—ã—Ö–æ–¥ –∏–∑ sqlite3
.quit
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `fix-db.sh` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
#!/bin/bash
cd /–ø—É—Ç—å/–∫/–ø—Ä–æ–µ–∫—Ç—É/backend

echo "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Prisma..."
npm run prisma:migrate:deploy

echo "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–∞..."
npm run prisma:generate

echo "–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
pm2 restart jingai-backend

echo "–ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: pm2 logs jingai-backend"
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   pm2 status
   ```

2. **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   pm2 logs jingai-backend --lines 50
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î:**
   ```bash
   sqlite3 prisma/prod.db ".tables" | grep SupportRequest
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
   ```bash
   curl http://localhost:4000/api/health
   ```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` —Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `DATABASE_URL`
- –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `backend/prisma/migrations/`
- –ö–æ–º–∞–Ω–¥–∞ `prisma migrate deploy` –±–µ–∑–æ–ø–∞—Å–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ï—Å–ª–∏ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–µ—Ç–µ —Ç–∞–±–ª–∏—Ü—ã, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `_prisma_migrations` –≤ Prisma

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs jingai-backend`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ –ë–î –≤ `.env` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –ë–î: `ls -la prisma/prod.db`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `prisma/migrations/`

